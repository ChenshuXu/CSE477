/*! ajaxnoir 2018-04-24 */

function Login(s){var e=$(s);e.submit(function(t){t.preventDefault(),console.log("Submitted"),$.ajax({url:"post/login.php",data:e.serialize(),method:"POST",success:function(t){var e=parse_json(t);console.log(e),e.ok?window.location.assign("./"):$(s+" .message").html("<p>"+e.message+"</p>")},error:function(t,e,a){console.log(a),$(s+" .message").html("<p>Error: "+a+"</p>")}})})}function MovieInfo(t,e,a){console.log("MovieInfo: "+e+"/"+a);var s=$(t),r=this;$.ajax({url:"https://api.themoviedb.org/3/search/movie",data:{api_key:"e77c23b640548a2dfff9b85c9e7c92b7",query:e,year:a},method:"GET",dataType:"text",success:function(t){var e=parse_json(t);if(console.log(e),0===e.total_results)s.html("<p>No information available</p>");else{var a=e.results[0];r.displayMovie(s,a)}},error:function(){console.log("error"),s.html("<p>Unable to communicate<br>with themoviedb.org</p>")}})}function parse_json(e){try{var t=$.parseJSON(e)}catch(t){throw"JSON parse error: "+e}return t}function Stars(t){this.form=$(t),this.msg=$(t+" .message"),this.movieTable=$(t+" .table");var e=$(t+" table");console.log("Stars constructor111");for(var a=e.find("tr"),s=1;s<a.length;s++)for(var r=$(a.get(s)),o=r.find('input[name="id"]').val(),i=r.find("img"),n=0;n<i.length;n++){var l=$(i.get(n));this.installListener(r,l,o,n+1)}}MovieInfo.prototype.displayMovie=function(t,e){console.log(e);var a="<ul>",s=e.title;console.log(s),a+='<li><a href=""><img src="images/info.png"></a><div class="show"><p>Title:'+s+"</p><p>Release Date:"+e.release_date+"</p><p>Vote average:"+e.vote_average+"</p><p>Vote count:"+e.vote_count+"</p></div></li>",a+='<li><a href=""><img src="images/plot.png"></a><div class="show"><p>'+e.overview+"</p></div></li>",a+='<li><a href=""><img src="images/poster.png"></a><div class="show"><p class="poster"><img src="http://image.tmdb.org/t/p/w500'+e.poster_path+'"></p></div></li>',a+="</ul>",t.html(a)},Stars.prototype.installListener=function(s,t,e,r){var o=this;t.click(function(){console.log("Click on "+e+" rating: "+r),$.ajax({url:"post/stars.php",data:{id:e,rating:r},method:"POST",success:function(t){var e=parse_json(t);if(e.ok){o.message("<p>Successfully updated</p>"),o.update(s,r);var a=e.movies;o.updateTable(a)}else o.message("<p>Update failed</p>")},error:function(t,e,a){o.message("<p>Error: "+a+"</p>")}})})},Stars.prototype.update=function(t,e){for(var a=t.find("img"),s=0;s<a.length;s++){var r=$(a.get(s));s<e?r.attr("src","images/star-green.png"):r.attr("src","images/star-gray.png"),t.find("span.num").text(e+"/10")}},Stars.prototype.message=function(t){var e=this.msg;e.hide().fadeIn(500),e.html(t),e.delay(2e3).fadeOut(500)},Stars.prototype.updateTable=function(t){for(var e=this.movieTable,a="<table>\n<tr><th>&nbsp;</th><th>Title</th><th>Year</th><th>Rating</th></tr>",s=0;s<t.length;s++){var r=t[s],o=r.title,i=r.year,n=r.rating,l=r.id;if(null===n)m="not rated";else{var p=parseInt(n,10);m='<span class="stars">'+'<img src="images/star-green.png">'.repeat(p)+'<img src="images/star-gray.png">'.repeat(10-p)+'</span> <span class="num">'+p+"/10</span>"}a+='<tr><td><input type="radio" value="'+l+'" name="id"></td><td>'+o+"</td><td>"+i+"</td><td>"+m+"</td></tr>"}a+="</table>",e.html(a);for(var g=e.find("tr"),c=1;c<g.length;c++)for(var d=$(g.get(c)),m=(l=d.find('input[name="id"]').val(),d.find("img")),f=0;f<m.length;f++){var h=$(m.get(f));this.installListener(d,h,l,f+1)}};